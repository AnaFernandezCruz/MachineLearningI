---
title: "GLM"
---

```{r load_libraries}
library(class)
library(dplyr)
library(caret)
library (ROCR)
source("funcs.R")
```


```{r load_data, message=FALSE, warning=FALSE, echo=TRUE}

dataTrain_origin <- readRDS("datasetTrain.rds")
dataTest_origin <- readRDS("datasetTest.rds")

```


```{r choose_features}

dataTrain <- dataTrain_origin %>% dplyr::select(-SalePrice)
dataTest <- dataTest_origin %>% dplyr::select(-SalePrice)


```


```{r}
#group <- c('GrLivArea','LotArea','TotalSF','MSSubClass','Neighborhood','BedroomAbvGr','BldgType','OverallCond','TotalBsmtSF', 'GrupoPrecio')
group <- c('GrLivArea','LotArea','TotalSF','ExterQual','KitchenQual', 'GrupoPrecio')
remove <- c('GrupoPrecio')
col_to_factor <- colnames(dataTrain) [! colnames(dataTrain) %in% remove]

dataTrain <- dataTrain %>% dplyr::select(group)
dataTest <- dataTest %>% dplyr::select(group)

dataTrain <- dataTrain %>% as_factor_all(col_to_factor)
dataTest <- dataTest %>% as_factor_all(col_to_factor)
```






```{r process_data }


XTrain <- dataTrain %>% dplyr::select(-GrupoPrecio)
YTrain <- dataTrain$GrupoPrecio

XTest <- dataTest %>% dplyr::select(-GrupoPrecio)
YTest <- dataTest$GrupoPrecio

```

```{r}
glm = glm(GrupoPrecio ~ ., family = binomial, data = dataTrain)
summary(glm)

round(exp(cbind(Estimate = coef(glm), confint(glm))),2)


glm_del = update(glm, . ~ . - KitchenQual - ExterQual) 

anova(glm_del, glm, test = "Chisq")


head(predict(glm))


```


```{r}

```




--------------------------------------------------------------------
```{r run_model}

model <- glm(GrupoPrecio ~ ., family=binomial(link='logit'),data=dataTrain)
summary(model)

pred <- predict(model, newdata = XTest,type='response')
pred <- ifelse(pred > 0.5,1,0)
misClasificError <- mean(pred != YTest)
(misClasificError)
```

```{r evaluate_model}

tab_test <- table(pred, YTest, dnn = c("Actual", "Predichos"))

(tab_test)

accuracy(tab_test)
knn_test_error <- calc_error_rate(predicted.value=model, true.value=YTest)
(knn_test_error)

draw_confusion_matrix(tab_test, "Actual", "Predichos")
```