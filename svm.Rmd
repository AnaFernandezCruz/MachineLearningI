---
title: "SVM"
output: 
  html_document:
    code_folding: hide
---

```{r load_libraries}
library(class)
library(dplyr)
library(caret)
library (ROCR)
library(e1071)
source("funcs.R")
```


```{r load_data, message=FALSE, warning=FALSE, echo=TRUE}

dataTrain <- readRDS("datasetTrain.rds")
dataTest <- readRDS("datasetTest.rds")

```

```{r choose_features}

dataTrain <- dataTrain %>% dplyr::select(-SalePrice)
dataTest <- dataTest %>% dplyr::select(-SalePrice)

group <- c('TotalSF','LotArea','GrupoPrecio')

dataTrain <- dataTrain %>% dplyr::select(group)
dataTest <- dataTest %>% dplyr::select(group)


```


```{r process_data }

XTrain <- dataTrain %>% dplyr::select(-GrupoPrecio)
YTrain <- dataTrain$GrupoPrecio

XTest <- dataTest %>% dplyr::select(-GrupoPrecio)
YTest <- dataTest$GrupoPrecio

```



```{r run_model}

#model <- svm(formula = GrupoPrecio ~ ., data = dataTrain, kernel = "linear", cost = 1, scale = TRUE)
model <- best.tune(method = svm, train.x = GrupoPrecio ~ ., data = dataTrain, ranges = list(cost = c(0.001, 0.01, 0.1, 1, 5, 10, 100)), kernel = "radial", gamma = 1)

plot(model, dataTrain)

```

```{r evaluate_model}

pred <- predict(model, newdata = XTest)
tab_test <- table(pred, YTest, dnn = c("Actual", "Predichos"))
(tab_test)
draw_confusion_matrix(tab_test, "Actual", "Predichos")

accuracy(tab_test)
knn_test_error <- calc_error_rate(predicted.value=pred, true.value=YTest)
(knn_test_error)
```

```{r}

cm <- confusionMatrix(tab_test)
(cm)
```


